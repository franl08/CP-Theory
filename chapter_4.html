<!DOCTYPE HTML>
<html lang="pt" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Paralelismo de Dados e Multithreading em Uniprocessadores - Teóricas de CP</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Apresentação da UC</a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Otimização de Código Sequencial</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> Hierarquia de Memória</a></li><li class="chapter-item expanded "><a href="chapter_4.html" class="active"><strong aria-hidden="true">4.</strong> Paralelismo de Dados e Multithreading em Uniprocessadores</a></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">5.</strong> Aceleradores de Computação: GPU e CUDA</a></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">6.</strong> Introdução à Programação com Memória Partilhada</a></li><li class="chapter-item expanded "><a href="chapter_7.html"><strong aria-hidden="true">7.</strong> Programação Paralela com Memória Partilhada</a></li><li class="chapter-item expanded "><a href="chapter_8.html"><strong aria-hidden="true">8.</strong> Medição e Otimização de Desempenho em Memória Partilhada</a></li><li class="chapter-item expanded "><a href="chapter_9.html"><strong aria-hidden="true">9.</strong> Programação em Memória Distribuída com Passagem de Mensagens</a></li><li class="chapter-item expanded "><a href="chapter_10.html"><strong aria-hidden="true">10.</strong> Algoritmos Paralelos (Sorting)</a></li><li class="chapter-item expanded "><a href="chapter_11.html"><strong aria-hidden="true">11.</strong> De Multicore para Manycore</a></li><li class="chapter-item expanded "><a href="chapter_12.html"><strong aria-hidden="true">12.</strong> Sistemas Top HPC nas listas do TOP500</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Teóricas de CP</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="paralelismo-de-dados-e-multithreading-em-uniprocessadores"><a class="header" href="#paralelismo-de-dados-e-multithreading-em-uniprocessadores">Paralelismo de Dados e <em>Multithreading</em> em Uniprocessadores</a></h1>
<h2 id="taxonomia-de-flynn"><a class="header" href="#taxonomia-de-flynn">Taxonomia de Flynn</a></h2>
<p><img src="images/flynn_tax.png" alt="image Taxonomia de Flynn" /></p>
<ul>
<li><strong>SISD</strong>: <em>Single Instruction, Single Data</em>;</li>
<li><strong>SIMD</strong>: <em>Single Instruction, Multiple Data</em>;</li>
<li><strong>MISD</strong>: <em>Multiple Instruction, Single Data</em>;</li>
<li><strong>MIMD</strong>: <em>Multiple Instruction, Multiple Data</em>;</li>
<li><strong>SPMD</strong>: <em>Single Program, Multiple Data</em>:
<ul>
<li>Programa paralelo num computador MIMD;</li>
<li>Precisa de código condicional para diferentes processadores.</li>
</ul>
</li>
</ul>
<h2 id="introdução"><a class="header" href="#introdução">Introdução</a></h2>
<ul>
<li>Arquiteturas SIMD permitem que se explore, de forma significativa, paralelismo ao nível dos dados para:
<ul>
<li>Computação científica orientada a matrizes;</li>
<li>Processamento de mídias;</li>
<li>Algoritmos de <em>Machine Learning</em>.</li>
</ul>
</li>
<li>Além disso, estas arquiteturas são mais eficientes que as MIMD a nível energético;
<ul>
<li>Precisam de dar <em>fetch</em> a uma única instrução por operação de dados;</li>
<li>Isto torna estas arquiteturas atrativas para dispositivos móveis pessoais.</li>
</ul>
</li>
<li>Por fim, esta arquitetura ainda permite que o programador tenha um pensamento sequencial.</li>
</ul>
<h2 id="paralelismo-simd"><a class="header" href="#paralelismo-simd">Paralelismo SIMD</a></h2>
<ul>
<li>Arquiteturas vetoriais;</li>
<li>Extensões SIMD;
<ul>
<li>É uma extensão ao <em>instruction set</em> do SIMD para arquiteturas x86 desenhada pela Intel;</li>
<li>Contém 70 novas instruções, sendo que grande parte trabalha com dados de <em>single precision floating-points</em>;</li>
<li>Estas instruções (e as instruções do SIMD), têm um grande ganho de desempenho quando efetuam exatamente as mesmas operações em múltiplos objetos de dados. Geralmente, são utilizadas para processamento de sinais digitais e para processamento gráfico.</li>
</ul>
</li>
<li>GPUs;</li>
<li>Para processadores x86:
<ul>
<li>Expectável que se tenha 2 <em>cores</em> adicionais por ano;</li>
<li>A largura é expectável que duplique a cada 4 anos;</li>
<li>Potencial ganho de velocidade: 2x a velocidade do MIMD.</li>
</ul>
</li>
</ul>
<h3 id="arquiteturas-vetoriais"><a class="header" href="#arquiteturas-vetoriais">Arquiteturas Vetoriais</a></h3>
<ul>
<li>Ideia base:
<ul>
<li>Lê conjuntos de elementos de dados (da memória) para registos vetoriais;</li>
<li>Efetua operações sobre esses registos;</li>
<li>Dispersa os resultados obtidos de volta à memória (<em>scatter</em>).</li>
</ul>
</li>
<li>Os registos são controlados pelo compilador.
<ul>
<li>Utilizado para esconder a latência da memória;</li>
<li>Alavanca a largura de banda da memória.</li>
</ul>
</li>
</ul>
<h4 id="vmips"><a class="header" href="#vmips">VMIPS</a></h4>
<ul>
<li>Exemplo: RV64V
<ul>
<li>Tem 32 registos vetoriais de 64 <em>bits</em>;
<ul>
<li>O ficheiro de registo tem 16 portas de leitura e 8 de escrita.</li>
</ul>
</li>
<li>Unidades funcionais vetoriais;
<ul>
<li>Completamente em <em>pipeline</em>;</li>
<li>Deteta dependências de dados e de controlo.</li>
</ul>
</li>
<li>Unidade vetorial de <em>load-store</em>;
<ul>
<li>Completamente em <em>pipeline</em>;</li>
<li>Uma <em>word</em> por <em>clock cycle</em> após a latência inicial.</li>
</ul>
</li>
<li>Registos escalares.
<ul>
<li>31 registos de propósito geral;</li>
<li>32 registos de <em>floating-point</em>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="desafios"><a class="header" href="#desafios">Desafios</a></h4>
<ul>
<li>Tempo de arranque;
<ul>
<li>Latência de uma unidade funcional vetorial é bastante alta.</li>
</ul>
</li>
<li>Melhorias possíveis:
<ul>
<li>Mais do que 1 elemento por <em>clock cycle</em>;</li>
<li><em>Non-64 wide vectors</em>;</li>
<li>Vetorizar o código de <em>if-statements</em>;</li>
<li>Otimizações ao sistema de memória de forma a suportar processadores vetoriais;</li>
<li>Múltiplas matrizes dimensionais (acessos à memória sem passos unitários);</li>
<li>Matrizes dispersas;</li>
<li>Programar de forma específica para um computador vetorial.</li>
</ul>
</li>
</ul>
<h4 id="programação-vetorial"><a class="header" href="#programação-vetorial">Programação Vetorial</a></h4>
<ul>
<li>Os compiladores são elementos chave para dar dicas sobre se uma secção de código irá vetorizar ou não;</li>
<li>Devemos verificar se as iterações entre <em>loops</em> terão depedências de dados e/ou <em>if-statements</em>, pois, caso contrário, a vetorização será comprometida;</li>
<li>O custo de arquiteturas vetoriais é muito elevado, no entanto existem algumas variantes como extensões a processadores escalares, mas:
<ul>
<li>Não suportam acessos não unitários à memória, pelo que se deve ter cuidado na definição de estruturas de dados;</li>
<li>Também não suportam o <em>mask register</em>, <em>gather-scatter</em>, etc...</li>
</ul>
</li>
</ul>
<h3 id="extensões-a-simd"><a class="header" href="#extensões-a-simd">Extensões a SIMD</a></h3>
<ul>
<li>Aplicações de mídia operam em tipos de dados mais pequenos que tamanho nativo de uma <em>word</em>;</li>
<li>Limitações comparadas a arquiteturas vetoriais:
<ul>
<li>Número de operando de dados codificado no <em>op code</em>;</li>
<li>Não há modos de endereçamento sofisticados;</li>
<li>Não há <em>mask register</em>.</li>
</ul>
</li>
</ul>
<h3 id="implementações-simd"><a class="header" href="#implementações-simd">Implementações SIMD</a></h3>
<ul>
<li>Da Intel:
<ul>
<li>MMX (1996);</li>
<li><em>Streaming SIMD Extensions</em> (SSE) (1999);</li>
<li><em>Advanced Vector eXtensions</em> (AVX) (2010...);
<ul>
<li>Operações em 8 <em>32-bit fp</em> ou 4 <em>64-bit fp</em> (inteiros apenas no AVX-2);</li>
<li>Largura de <em>512-bits</em> no AVX-512 (e no Larrabee e Phi-KNC).</li>
</ul>
</li>
<li>Os operandos têm de estar em localizações de memória consecutivas e alinhadas!</li>
</ul>
</li>
<li>AMD Zen/Epyc: semelhante ao AVX-2;</li>
<li>Arquitetura ARMv8 (64-bit): NEON e SVE.</li>
</ul>
<h2 id="extensões-vetoriais"><a class="header" href="#extensões-vetoriais">Extensões Vetoriais</a></h2>
<ul>
<li>Arquiteturas vetoriais/extensões SIMD são abordagens híbridas:
<ul>
<li>Mistura capacidades de operações (super)escalares + vetoriais num único dispositivo;</li>
<li>Abordagem altamente <em>pipelined</em> de forma a reduzir a <em>penalty</em> de acesso à memória;</li>
<li>Acesso fechado à memória partilhada provoca uma menor latência.</li>
</ul>
</li>
<li>Evolução destas arquiteturas:
<ul>
<li>Aceleradores de computação otimizados para <em>number crunching</em> (GPUs);</li>
<li>Adição do suporte a operações de multiplicação + acumulação para matrizes;
<ul>
<li>Muitas aplicações utilizam computações com matrizes, nomeadamente o <em>dot product</em>;</li>
<li>Os produtores, muitas vezes, chamam a esta extensão <em>Tensor Processing Unit</em> (TPU).</li>
</ul>
</li>
<li>Suporte para <em>half-precision FP</em> e inteiros de <em>8 bits</em>.
<ul>
<li>Algoritmos de ML que utilizam redes neuronais precisam de computacionar um modelo durante a fase de treino, onde produtos de matrizes intensivos são feitos sem necessitarem de grande precisão.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="unicore-multithreading"><a class="header" href="#unicore-multithreading"><em>Unicore Multithreading</em></a></h2>
<ul>
<li>Corre múltiplas <em>threads</em> numa execução em paralelo.
<ul>
<li>Partilha todos os recursos, exceto registos replicados, PC/IP, etc...</li>
<li>Troca rapidamente entre <em>threads</em>.</li>
</ul>
</li>
<li>Abordagens:
<ol>
<li><em>Fine-grain Multithreading</em>/<em>time-multiplexed multithreading</em>
<ol>
<li>Troca de <em>threads</em> após cada <em>clock cycle</em>;</li>
<li>Intercala a execução de instruções;</li>
<li>Se uma <em>thread</em> parar, as outras são executadas.</li>
</ol>
</li>
<li><em>Coarse-grain Multithreading</em>
<ol>
<li>Só troca de <em>thread</em> em grandes paragens (p.e. uma <em>miss</em> na <em>cache</em> de nível 2);</li>
<li>Simplifica o <em>hardware</em>, mas não esconde pequenas paragens (p.e. para dependências de dados).</li>
</ol>
</li>
<li><em>Simultaneous multithreading</em>
<ol>
<li>O processador agenda os múltiplos problemas de forma dinâmica:
<ol>
<li>Agenda instruções das múltiplas <em>threads</em>;</li>
<li>As instruções de <em>threads</em> independentes são executadas quando as unidades funcionais estiverem disponíveis;</li>
<li>Entre <em>threads</em>, as dependências são geridas através do agendamento e renomeação de registos.</li>
</ol>
</li>
<li>Exemplo: Intel do <em>Pentium-4 HT</em>.
<ol>
<li>Duas <em>threads</em>: registos duplicados, unidade funcional e <em>caches</em> partilhadas. </li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="chapter_3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="chapter_5.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="chapter_3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="chapter_5.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
